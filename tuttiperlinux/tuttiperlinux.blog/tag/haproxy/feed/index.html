<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" xmlns:media="http://search.yahoo.com/mrss/"
	>

<channel>
	<title>haproxy &#8211; Tutti per Linux</title>
	<atom:link href="https://tuttiperlinux.blog/tag/haproxy/feed/" rel="self" type="application/rss+xml" />
	<link>https://tuttiperlinux.blog</link>
	<description>Tutto cio&#039; che avresti sempre voluto capire su Linux ed il mondo Digitale</description>
	<lastBuildDate>Mon, 14 Dec 2015 17:19:39 +0000</lastBuildDate>
	<language>it-IT</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>http://wordpress.com/</generator>
<cloud domain='tuttiperlinux.blog' port='80' path='/?rsscloud=notify' registerProcedure='' protocol='http-post' />
<image>
		<url>https://secure.gravatar.com/blavatar/fa5c4cf69896031d9ec71ff8d5aafd25?s=96&#038;d=https%3A%2F%2Fs0.wp.com%2Fi%2Fbuttonw-com.png</url>
		<title>haproxy &#8211; Tutti per Linux</title>
		<link>https://tuttiperlinux.blog</link>
	</image>
	<atom:link rel="search" type="application/opensearchdescription+xml" href="https://tuttiperlinux.blog/osd.xml" title="Tutti per Linux" />
	<atom:link rel='hub' href='https://tuttiperlinux.blog/?pushpress=hub'/>
	<item>
		<title>MaxScale &#8211; un proxy per i Database MariaDB e MySQL</title>
		<link>https://tuttiperlinux.blog/2015/12/14/maxscale-un-proxy-per-i-database-mariadb-e-mysql/</link>
					<comments>https://tuttiperlinux.blog/2015/12/14/maxscale-un-proxy-per-i-database-mariadb-e-mysql/#respond</comments>
		
		<dc:creator><![CDATA[Tutti per Linux]]></dc:creator>
		<pubDate>Mon, 14 Dec 2015 17:19:39 +0000</pubDate>
				<category><![CDATA[DB]]></category>
		<category><![CDATA[Proxy]]></category>
		<category><![CDATA[alta affidabilita]]></category>
		<category><![CDATA[cms]]></category>
		<category><![CDATA[haproxy]]></category>
		<category><![CDATA[load balancing]]></category>
		<category><![CDATA[mariadb]]></category>
		<category><![CDATA[maxscale]]></category>
		<category><![CDATA[mysql db]]></category>
		<category><![CDATA[mysql proxy]]></category>
		<category><![CDATA[proxy db]]></category>
		<category><![CDATA[replica master slave]]></category>
		<guid isPermaLink="false">http://tuttiperlinux.com/?p=1186</guid>

					<description><![CDATA[MaxScale è il nuovo database proxy server open source sviluppato da MariaDB Corporation Ab. MaxScale nasce con un concetto di proxy alla base, ma con una filosofia ed un approccio &#8220;database centrico&#8221; ed una architettura a plugin estremamente configurabile. Per chi si fosse perso i precedenti articoli riguardanti i Proxy Server, ricordiamo che, un proxy, &#8230; <a href="https://tuttiperlinux.blog/2015/12/14/maxscale-un-proxy-per-i-database-mariadb-e-mysql/">Continua a leggere <span class="meta-nav">&#8594;</span></a>]]></description>
										<content:encoded><![CDATA[<div data-shortcode="caption" id="attachment_1187" style="width: 310px" class="wp-caption alignnone"><img loading="lazy" aria-describedby="caption-attachment-1187" data-attachment-id="1187" data-permalink="https://tuttiperlinux.blog/2015/12/14/maxscale-un-proxy-per-i-database-mariadb-e-mysql/mariadb-maxscale/#main" data-orig-file="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg" data-orig-size="638,452" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="mariadb-maxscale" data-image-description="&lt;p&gt;Maxscale &#8211; Proxy per MariaDB &amp;amp; Mysql&lt;/p&gt;
" data-image-caption="&lt;p&gt;Maxscale &#8211; Proxy per MariaDB &amp;amp; Mysql&lt;/p&gt;
" data-medium-file="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=300" data-large-file="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=600" class="size-medium wp-image-1187" src="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=300&#038;h=213" alt="Maxscale - Proxy per MariaDB &amp; Mysql" width="300" height="213" srcset="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=300&amp;h=213 300w, https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=600&amp;h=426 600w, https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=150&amp;h=106 150w" sizes="(max-width: 300px) 100vw, 300px" /><p id="caption-attachment-1187" class="wp-caption-text">Maxscale &#8211; Proxy per MariaDB &amp; Mysql</p></div>
<p><strong>MaxScale</strong> è il nuovo <strong>database proxy server</strong> open source sviluppato da <a href="https://mariadb.com/">MariaDB Corporation Ab</a>.</p>
<p>MaxScale nasce con un concetto di proxy alla base, ma con una filosofia ed un approccio &#8220;database centrico&#8221; ed una architettura a plugin estremamente configurabile.</p>
<p>Per chi si fosse perso i precedenti articoli riguardanti i Proxy Server, ricordiamo che, un proxy, è un server che fa da intermediario in una connessione, ossia esso riceve le richieste da un client e le reindirizza verso altri server che sono i destinatari delle richieste. In altre parole un proxy funziona come un centralinista: riceve la chiamata del cliente  e la gira al primo operatore libero.<br />
Per capire meglio cosa e&#8217; in grado fare elenchiamo alcune delle sue funzionalità principali quali:</p>
<ul>
<li>controllo della disponibilità del Database (monitoring)</li>
<li>load balancing</li>
<li>analisi della query in ingresso per capire se indirizzarla su una specifica tipologia di server</li>
</ul>
<p>tutto questo, e molto altro ancora.</p>
<p>MaxScale si può inserire in modo trasparente tra l&#8217;applicativo e il server MySQL, esattamente come fa un proxy web tra il nostro browser e il sito che stiamo cercando di visitare.<br />
Grazie ad un proxy è possibile avere:</p>
<ul>
<li>Ridondanza: usando più di un database dietro al proxy, poiche&#8217; un solo server non fornisce l&#8217;affidabilità e l&#8217;alta disponibilità in caso di down di una macchina.</li>
<li>Diminuizione dei costi di infrastruttura: perché generalmente due server piccoli sono meno costosi che un unico server molto performante.</li>
</ul>
<p>Per migliorare la spiegazione ora vedremo due tipi di database proxy server:</p>
<p>I proxy di livello trasporto come <a href="http://tuttiperlinux.com/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/">HAProxy</a> (di cui abbiamo piu&#8217; volte parlato in altri articoli).<br />
I proxy di livello applicativo come <a href="http://tuttiperlinux.com/2015/06/12/maxscale-db-proxy-scalabile/">MaxScale</a><br />
HAProxy: un proxy efficiente, rapido e funzionale</p>
<p>Fino ad oggi tra i proxy più usati in ambito MySQL Cluster è l&#8217;HAProxy che lavora ad un livello più basso (livello 4: trasporto). HAproxy pero&#8217; non conosce nulla di MySQL e si occupa quindi soltanto di bilanciare le connessioni tra i server. Haproxy e&#8217; molto veloce, leggero ed efficente, tuttavia questo tipo di bilanciamento è fatto senza che il proxy sia a conoscenza di cosa sta smistando. Questo rende il sistema meno efficente poiché un server può ricevere molte richieste pesanti, mentre altri server possono essere scarichi. Quindi l&#8217;HAProxy non è la scelta vincente in tutti i casi.</p>
<p>MaxScale: e&#8217; un proxy che in configurazioni di questo tipo può fare cose incredibili</p>
<p>MaxScale lavora a livello più alto (livello 7: applicativo) e, monitorando i server riesce a capire cosa sta succedendo all&#8217;interno dell&#8217;infrastruttura. Conoscendo il protocollo MySQL può intervenire manipolando il traffico tra client e server. Ecco alcune delle sue principali funzionalità:</p>
<ul>
<li>Filtro delle query al database</li>
<li>Gestione del routing: instradamento delle richieste a uno o più database server</li>
<li>Modifica delle query al volo prima che raggiungano il database</li>
<li>Possibilità di nascondere la struttura interna dell&#8217;infrastruttura lasciando un singolo punto d&#8217;accesso.</li>
<li>Alta affidabilità e scalabilità del sistema</li>
<li>Possibilità di spostare un database dal server locale ad un server esterno senza modificare la configurazione delle applicazioni</li>
<li>Divide automaticamente le scritture sul server MASTER e le letture su uno o più database SLAVE.</li>
<li>MaxScale può fornire un Load Balacing delle connessioni senza bisogno di utilizzare applicazioni o CMS che prevedano questa funzionalità. Questo significa che CMS come Joomla! o WordPress possono trarre i benefici usando una replicazione Master/Slave per rendere scalabile il proprio sito.</li>
</ul>
<p>Caratteristiche di MaxScale</p>
<p>Il punto di forza di MaxScale è sicuramente la sua modularità che permette una notevole libertà adattandosi a molti casi d&#8217;uso. MaxScale è :</p>
<ul>
<li>Modulare: un sistema di moduli ne definisce le funzionalità</li>
<li>Estendibile: è possibile applicare più filtri anche in cascata</li>
<li>Flessibile: i moduli e i filtri possono essere aggiunti dinamicamente</li>
</ul>
<p>I moduli base di MaxScale</p>
<p>Ecco i 5 moduli che costituiscono il cuore di MaxScale:</p>
<ul>
<li><strong>Protocol</strong>: da la possibilità di utilizzare più protocolli es. MySQL client, http, telnet;<br />
I client si connettono a MaxScale anziché al database MySQL senza accorgersi della differenza. Possono usare le stesse librerie di connessione utilizzate fino ad ora: es. MySQL client o MariaDB client</li>
<li><strong>Authentication</strong>: il sistema di autenticazione permette ai client di accedere a MaxScale usando le credenziali presenti sui server di Backend;<br />
MaxScale non ha un sistema di autenticazione o un database di utenti. Vengono utilizzati gli stessi utenti presenti sui database di backend, caricati all&#8217;avvio dell&#8217;applicazione</li>
<li><strong>Monitor</strong>: legge la configurazione dello stato del sistema direttamente dai server di backend;<br />
Viene utilizzato per capire in ogni momento lo stato di tutti i database di backend collegati a MaxScale. In questo modo è possibile sapere qual&#8217;è il server Master e quanti Slave stanno replicando correttamentei dati. Il monitor può essere utilizzato per controllare un Galera Cluster.</li>
<li><strong>Router</strong>: smista le connessioni a uno o più database di backend;<br />
Dirige il traffico dal client ai server utilizzando una regola specifica denominata connection routing</li>
<li><strong>Filter e logging</strong>: i filtri permettono di modificare le query oppure di scrivere un file di log con tutte le richieste e le risposte ricevute;<br />
Tra i più potenti strumenti messi a disposizione di MaxScale ci sono sicuramente i filtri che permettono di effettuare operazioni avanzate sulle query senza modificare il comportamento dell&#8217;applicazione, 1) processando query SQL e risultati, 2) utilizzando una semplice regex, 3)  analizzando, modificando o rifiutando le query, 4) mettendo più filtri in cascata</li>
</ul>
<p>Non resta che testare di persona, magari con un ambiente ad hoc con Docker e Vagrant.</p>
<p>&nbsp;</p>
]]></content:encoded>
					
					<wfw:commentRss>https://tuttiperlinux.blog/2015/12/14/maxscale-un-proxy-per-i-database-mariadb-e-mysql/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
		
		<media:content url="https://2.gravatar.com/avatar/855ab7cb725a5b56c356471b79d1cef6?s=96&#38;d=&#38;r=G" medium="image">
			<media:title type="html">lordisil72lordisil72</media:title>
		</media:content>

		<media:content url="https://tuttiperlinux.files.wordpress.com/2015/12/mariadb-maxscale.jpg?w=300" medium="image">
			<media:title type="html">Maxscale - Proxy per MariaDB &#038; Mysql</media:title>
		</media:content>
	</item>
		<item>
		<title>Load Balancing Systems</title>
		<link>https://tuttiperlinux.blog/2015/12/02/load-balancing-systems/</link>
					<comments>https://tuttiperlinux.blog/2015/12/02/load-balancing-systems/#comments</comments>
		
		<dc:creator><![CDATA[Tutti per Linux]]></dc:creator>
		<pubDate>Wed, 02 Dec 2015 17:34:29 +0000</pubDate>
				<category><![CDATA[Load Balancing]]></category>
		<category><![CDATA[application server]]></category>
		<category><![CDATA[Citrix]]></category>
		<category><![CDATA[F5]]></category>
		<category><![CDATA[gmail]]></category>
		<category><![CDATA[haproxy]]></category>
		<category><![CDATA[ipvsadm]]></category>
		<category><![CDATA[layer4]]></category>
		<category><![CDATA[layer7]]></category>
		<category><![CDATA[load balancing]]></category>
		<category><![CDATA[OSI]]></category>
		<category><![CDATA[Radware]]></category>
		<category><![CDATA[ssl]]></category>
		<category><![CDATA[webserver]]></category>
		<guid isPermaLink="false">http://tuttiperlinux.com/?p=1176</guid>

					<description><![CDATA[Ormai Internet e&#8217; parte della vita di milioni di persone e&#8217; lo sara&#8217; sempre di piu&#8217;. Sono lontanissimi i tempi dei siti statici con qualche migliaio di accessi al mese o poco piu&#8217;, oggi quasi ogni tipologia di servizio offerto dalle aziende o dalla pubblica amministrazione, ha la gestione su di un portale Internet, dunque &#8230; <a href="https://tuttiperlinux.blog/2015/12/02/load-balancing-systems/">Continua a leggere <span class="meta-nav">&#8594;</span></a>]]></description>
										<content:encoded><![CDATA[<div data-shortcode="caption" id="attachment_1177" style="width: 310px" class="wp-caption alignnone"><img loading="lazy" aria-describedby="caption-attachment-1177" data-attachment-id="1177" data-permalink="https://tuttiperlinux.blog/2015/12/02/load-balancing-systems/load-balancer-new/#main" data-orig-file="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png" data-orig-size="2400,2400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Load-Balancer" data-image-description="&lt;p&gt;Load Balancing Systems&lt;/p&gt;
" data-image-caption="&lt;p&gt;Load Balancing Systems&lt;/p&gt;
" data-medium-file="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=300" data-large-file="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=600" class="wp-image-1177 size-medium" src="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=300&#038;h=300" alt="Load Balancing Systems" width="300" height="300" srcset="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=300&amp;h=300 300w, https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=600&amp;h=600 600w, https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=150&amp;h=150 150w" sizes="(max-width: 300px) 100vw, 300px" /><p id="caption-attachment-1177" class="wp-caption-text">Load Balancing Systems</p></div>
<p>Ormai Internet e&#8217; parte della vita di milioni di persone e&#8217; lo sara&#8217; sempre di piu&#8217;. Sono lontanissimi i tempi dei siti statici con qualche migliaio di accessi al mese o poco piu&#8217;, oggi quasi ogni tipologia di servizio offerto dalle aziende o dalla pubblica amministrazione, ha la gestione su di un portale Internet, dunque la gestione degli accessi, al secondo, e&#8217; diventata la discriminante per valutare un ottimo servizio da uno scadente; si pensi alla fantastica operabilita&#8217; di portali come Facebook, Twitter o Gmail, solo per citarne alcuni, che permettono e gesticono l&#8217;accesso di milioni di utenti 24h senza praticamente disservizi o rallentamenti .</p>
<p>Ora dietro c&#8217;e&#8217; una mole di lavoro ingegneristico del software, dell&#8217;hardware, dell&#8217;architettura migliore, del DB piu&#8217; performante etc ma, prima che tutto cio&#8217; inizi ad operare l&#8217;utente dev&#8217;essere, per prima cosa, agganciato ed instradato verso il server (fisico o virtuale che sia) che accogliera&#8217; le sue operazioni (acquisti , home banking, pagamento bollette&#8230;), tutto cio verra&#8217; fatto dall&#8217;infrastruttura di Load Balancing, che puo&#8217; essere un fiore all&#8217;occhiello dell&#8217;azienda oppure trasformarsi in un Mega <strong>Point of Failure</strong>, quindi vediamo di spiegare meglio che cosa sono i Load Balancer e come operano.</p>
<p>Letteralmente “<strong>Load Balancing</strong>” significa bilanciare il carico di lavoro su più nodi dell’architettura.Viene spesso confuso come tecnica per ottenere l&#8217; High Availability (HA), ma pur condividendone alcuni mezzi, ha dei fini totalmente diversi.</p>
<p>In pratica il &#8220;bilanciatore di carico&#8221;, per chi non lo sapesse, è quel componente (di frontend) che prende in carico le connessioni in ingresso (quelle degli utenti per gli accessi POP/IMAP ad esempio) e le smista verso i server (backend) veri e propri che erogano i servizi (webserver, application server..). E’ sempre il bilanciatore che interviene quando un server di backend viene rimosso dal cluster, per manutenzione o interruzione, a dirottare il traffico verso i server rimasti attivi.</p>
<p>Uno degli errori più comuni per effettuare il Load Balancing è quello di prendere come riferimento il Load dei server, scrivendo sulle console delle nostre macchine il comando “uptime”, riceveremo come risposta un dato come questo</p>
<p>16:49 up 453 days, 12:17, 56 users, load averages: 0,59 0,46 0,47</p>
<p>dove gli ultimi tre numeri identificano il carico del server negli ultimi 1, 5 e 15 minuti rispettivamente.</p>
<p>Immaginiamo ora di aggiungere ulteriori nodi quando il carico di un server negli ultimi 5 minuti superera&#8217; il valore di 1,5. La nuova macchina aggiunta partirà con un carico pressoché a 0 e verrà invasa da centinaia di richieste fino a rischiarne la saturazione, e dovremo inoltre attendere altri 5 minuti prima che un nuovo bilanciamento possa intervenire.</p>
<p>Peccato che prima di quei 5 minuti il nostro nuovo server farà parecchia fatica a rispondere a tutte queste richieste, perdendo cosi di fatto parecchi utenti a causa di errori di pagina non trovata oppure di time out per la troppa attesa etc&#8230;.facendo perdere parecchi soldi all&#8217;azienda. Questo tipo di problema è chiamato “<strong>staleness</strong>”, e può essere aggirato con altre tecniche che non si basano su una metrica numerica.</p>
<p><strong>Come implementare il load balancing:</strong></p>
<p>Come scegliere quindi su quale server dirigere una richiesta?</p>
<p>La tecnica di Load Balaincing più semplice è detta <strong>Round Robin</strong>, il suo principio e&#8217; che ogni richiesta che viene effettuata viene smistata su un server differente, a rotazione.</p>
<p>In un cluster di 100 macchine, 100 richieste verranno distribuite su tutti 100 i servers a rotazione dal primo all’ultimo. Questa è una tecnica molto semplice da usare, e inclusa ad esempio già in Apache, ma si porta il limite che se un server è sovraccarico non avrà mail il tempo rientrare in una situazione di normalità che subito dopo dovra&#8217; gestire un&#8217;ennesima richiesta e cosi via.</p>
<p>La tecnica “<strong>Random</strong>” ci offre un modo elegante per distribuire le richieste; in pratica non si basa su nessuna metrica, ma per i puristi resta comunque fuori controllo poiche&#8217; offre comunque la possibilià (anche se randomica) di continuare a girare richieste verso server già sovraccarichi.</p>
<p>Una variante della tecnica “Random” è la “<strong>Weighted Random</strong>“, dove viene introdotta la variabile “potenza del server”, ossia i server più potenti avranno una possibilià più alta di ricevere richieste, rispetto ad hardware meno performante.</p>
<p>La tecnica “<strong>Predictive</strong>” invece è una variante del “Round Robin”, in questa metodologia vengono introdotte alcune variabili al normale ciclo per permettere di avere una ripartizione più accurata saltando ad esempio i server già troppo carichi. E’ una tecnica implementata a livello di Load Balancers hardware, e i produttori sono di solito restii a documentare gli algoritmi “Predictive”.</p>
<p>Resta scontato che, una volta scelta la tecnica preferita, dovremo prendere in considerazione anche altri problemi. Ora, ad esempio, proviamo ad uscire dal ragionamento di un singolo Load Balancer, e proviamo ad aumentare la posta ed a pensare in modalita&#8217; High Availability con almeno due bilanciatori dove il lavoro del primo verrà supportato o, in caso di problemi, preso in carico dal secondo, che redistribuirà il traffico secondo una sua logica.</p>
<p>Per l’utente finale (colui che naviga dal suo browser) non cambierà nulla, infatti il browser si connetterà ad un IP dove non ci sarà un webserver ad attenderlo, ma il Load Balancer. Il Load Balancer girerà quindi, seguendo il nostro metodo di allocazione scelto, la richiesta ad un webserver scarico pronto a risponderci.</p>
<p>Cosa fondamentale e&#8217; che i due, o più load balancer, devono essere in grado di parlarsi e condividere informazioni, così che entrambi sapranno che un dato server è da considerare sovraccarico o che un altro server sta per uscire dal pool.</p>
<p><strong>Come scegliere il giusto load balancing</strong></p>
<p>Scegliere il metodo di load balancing, e lo strumento col quale applicarlo, necessitano quindi di studi specifici sul tipo di traffico, e sull’architettura dell’applicazione che si vuole bilanciare, soprattutto quando entrano in gioco variabili come SSL.</p>
<p>L’SSL è basato sulla generazione di un certificato legato ad un IP, e in uno scenario dove abbiamo diversi IP virtuali che rigirano il traffico verso altri &#8220;nattati&#8221; diventa quantomeno improbabile poter gestire in modo corretto il certificato. Questo proprio perche&#8217; il certificato è usato per validare la reale identità del server web, quindi mettendoci in mezzo un load balancer otterremmo un “man in the middle” che invalidera&#8217; la connessione SSL.</p>
<p>L’unico modo diventa spostare la connessione SSL solo tra browser e Load balancer, inserendo il certificato sul VIP del sistema di Load Balancing e lasciando il traffico dopo il Load balancer in chiaro (anche se è sempre possibile attraverso una VPN ottenere maggiore sicurezza sui canali di comunicazione).</p>
<p>In sostanza, il Load balancing è un argomento semplice da capire, e probabilmente ancora più semplice da ottenere anche con hardware non dedicato, grazie alle diverse opportunità che il mondo Open Source ci regala.</p>
<p>Come sempre, il grosso del problema è strutturare l’applicazione nel suo complesso, incastrando i vari elementi affinché tutto il flusso dei dati sia ottimale.</p>
<p>La scelta del bilanciatore non e&#8217; facile, ce ne sono di diversi tipi, sia hardware che software e, molte volte, la loro bonta&#8217; non dipende dal prezzo che lo pagate ma dalla giusta scelta che farete a monte, di ottimizzazione del servizio che dovete erogare. Possiamo dire che molto spesso, in ambito Opensource la scelta ricade su <a href="http://www.linuxvirtualserver.org/whatis.html">LVS</a>, <a href="http://www.haproxy.org/">HAProxy</a>, <a href="http://tuttiperlinux.com/2014/08/06/catturare-il-traffico-di-rete/">Pound</a>&#8230;, mentre in ambiti piu&#8217; istituzionali (Banche, Assicurazioni etc) la scelta spesso ricade su <a href="https://f5.com/glossary/load-balancer/">F5</a>, <a href="https://www.citrix.it/products/netscaler-application-delivery-controller/overview.html">Citrix</a>, <a href="http://www.radware.com/Solutions/ApplicationDelivery/">Radware</a>&#8230;.</p>
<p>Personalmente sono un sostenitore di LVS, che ho usato spesso in grossi progetti, ma vediamo quali sono i suoi punti di forza confrontandolo con l&#8217;altro ottimo prodotto Open HAProxy.</p>
<p>LVS lavora in kernel-space (disponibile quindi solo per Linux) il che lo rende estremamente leggero e veloce, anche se limitato in termini di funzionalità. Haproxy è invece un software che gira in user-space, sicuramente più portabile (gira praticamente su qualsiasi Linux/Unix) ma anche più costoso in termini di risorse.</p>
<p>Per darvi un idea di quante poche risorse usa LVS, considerate che ogni connessione attiva occupa solo 128 bytes di memoria (nella tabella dove queste vengono memorizzate). Con circa 4GB di RAM sarete in grado di smistare qualcosa tipo 500.000 connessioni simultanee.</p>
<p>LVS lavora al layer 4 (vedi <a href="https://it.wikipedia.org/wiki/Open_Systems_Interconnection">Open Systems Interconnection</a>), mentre HAProxy lavora al layer 7 della pila OSI. Se questo da una parte è un vantaggio per haproxy, che può ispezionare anche il contenuto del pacchetto, di fatto si traduce in un maggiore carico a livello di CPU e quindi minore scalabilità.  In un bilanciatore di carico con LVS il carico del server sarà quasi sempre pari a 0.00, mentre con haproxy si manterrà intorno allo 0.50.</p>
<p>Sempre con LVS è possibile ottimizzare il consumo di banda dei singoli server che compongono il cluster. Se configurato in modalità “Direct Routing” (o LVS-TUN) il bilanciatore si farà carico solo del traffico in ingresso mentre saranno i singoli server di backend ad inviare il traffico di risposta ai client remoti. Con haproxy (o LVS configurato come NAT) tutto il traffico IN/OUT passa dal bilanciatore il che lo tiene maggiormente sotto stress e vi constringe a dimensionarlo in modo da poter sostenere un traffico di rete pari alla somma totale del traffico diretta verso l’intero cluster.</p>
<p>Non ultimo LVS puo&#8217; vantare il tool <strong>ipvsadm</strong>, questo ottimo tool aggiorna la tabella d’instradamento IPVS nel kernel. Ipvsadm consente di modificare la configurazione di LVS aggiungendo e rimuovendo servizi, modificando la modalita&#8217; di forwarding, paradigmi di bilanciamento, ecc. Il pacchetto ipvsadm non ha interfacce grafiche e segue il principio unix, <strong>fare una cosa sola e farla bene</strong>, quindi risponde al solo compito di avere uno strumento per il bilanciamento a livello 4.</p>
<p>Con ipvsadm è possibile selezionare un metodo per passare i pacchetti dal server LVS ai real server dove gira il servizio, i metodi principali sono:</p>
<p><strong>LVS-DR</strong> (direct routing) dove il MAC addresses nel pacchetto è cambiato ed il pacchetto indirizzatto verso il real server<br />
<strong>LVS-NAT</strong> basato sul network address translation (NAT)<br />
<strong>LVS-TUN</strong> (tunneling) where the packet is IPIP encapsulated and forwarded to the realserver.</p>
<p><span style="line-height:1.5;">Praticamente un bilanciatore di carico con LVS lo potete accendere, configurare e dimenticarvelo per anni.</span></p>
]]></content:encoded>
					
					<wfw:commentRss>https://tuttiperlinux.blog/2015/12/02/load-balancing-systems/feed/</wfw:commentRss>
			<slash:comments>1</slash:comments>
		
		
		
		<media:content url="https://2.gravatar.com/avatar/855ab7cb725a5b56c356471b79d1cef6?s=96&#38;d=&#38;r=G" medium="image">
			<media:title type="html">lordisil72lordisil72</media:title>
		</media:content>

		<media:content url="https://tuttiperlinux.files.wordpress.com/2015/12/load-balancer-new.png?w=300" medium="image">
			<media:title type="html">Load Balancing Systems</media:title>
		</media:content>
	</item>
		<item>
		<title>MaxScale DB Proxy scalabile</title>
		<link>https://tuttiperlinux.blog/2015/06/12/maxscale-db-proxy-scalabile/</link>
					<comments>https://tuttiperlinux.blog/2015/06/12/maxscale-db-proxy-scalabile/#comments</comments>
		
		<dc:creator><![CDATA[Tutti per Linux]]></dc:creator>
		<pubDate>Fri, 12 Jun 2015 18:32:46 +0000</pubDate>
				<category><![CDATA[DB]]></category>
		<category><![CDATA[Proxy]]></category>
		<category><![CDATA[SysAdmin]]></category>
		<category><![CDATA[architettura scalabile]]></category>
		<category><![CDATA[backend]]></category>
		<category><![CDATA[cluster]]></category>
		<category><![CDATA[cms]]></category>
		<category><![CDATA[filter]]></category>
		<category><![CDATA[haproxy]]></category>
		<category><![CDATA[linux blog in italiano]]></category>
		<category><![CDATA[logging]]></category>
		<category><![CDATA[mariadb]]></category>
		<category><![CDATA[master slave]]></category>
		<category><![CDATA[maxscale]]></category>
		<category><![CDATA[monitor]]></category>
		<category><![CDATA[mysql]]></category>
		<category><![CDATA[protocollo]]></category>
		<category><![CDATA[proxy server]]></category>
		<category><![CDATA[query]]></category>
		<category><![CDATA[routing]]></category>
		<guid isPermaLink="false">http://tuttiperlinux.com/?p=1137</guid>

					<description><![CDATA[&#160; Il suo nome per esteso e&#8217; &#8220;MariaDB MaxScale&#8221; ed è il nuovo database proxy server open source sviluppato da MariaDB Corporation Ab. In pratica  MaxScale ci permetta di avere database ad alte prestazioni, in grado di consentire la costruzione di architetture flessibili. Ecco nel dettaglio le sue caratteristiche e funzionalità principali. &#160; Innanzitutto ricordiamo a tutti &#8230; <a href="https://tuttiperlinux.blog/2015/06/12/maxscale-db-proxy-scalabile/">Continua a leggere <span class="meta-nav">&#8594;</span></a>]]></description>
										<content:encoded><![CDATA[<div class="element element-textarea first">
<p>&nbsp;</p>
<div data-shortcode="caption" id="attachment_1138" style="width: 255px" class="wp-caption alignleft"><img loading="lazy" aria-describedby="caption-attachment-1138" data-attachment-id="1138" data-permalink="https://tuttiperlinux.blog/2015/06/12/maxscale-db-proxy-scalabile/maxscale_mariadb_sceme/#main" data-orig-file="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg" data-orig-size="430,252" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;Martin Schindler&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1421339495&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="MaxScale_MariaDB_Sceme" data-image-description="&lt;p&gt;MaxScale DB Proxy Server&lt;/p&gt;
" data-image-caption="&lt;p&gt;MaxScale DB Proxy Server&lt;/p&gt;
" data-medium-file="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=300" data-large-file="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=430" class=" wp-image-1138" src="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=245&#038;h=144" alt="MaxScale DB Proxy Server" width="245" height="144" srcset="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=245&amp;h=144 245w, https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=150&amp;h=88 150w, https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=300&amp;h=176 300w, https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg 430w" sizes="(max-width: 245px) 100vw, 245px" /><p id="caption-attachment-1138" class="wp-caption-text">MaxScale DB Proxy Server</p></div>
<p>Il suo nome per esteso e&#8217; &#8220;<strong>MariaDB MaxScale</strong>&#8221; ed è il nuovo database proxy server open source sviluppato da MariaDB Corporation Ab.</p>
<p>In pratica  MaxScale ci permetta di avere database ad alte prestazioni, in grado di consentire la costruzione di architetture flessibili. Ecco nel dettaglio le sue caratteristiche e funzionalità principali.</p>
<p>&nbsp;</p>
<p>Innanzitutto ricordiamo a tutti che, un proxy è un server che fa da intermediario in una connessione: riceve le richieste da un client e le reindirizza verso altri server che sono i destinatari delle richieste. In altre parole un proxy è un mezzo per deviare una connessione tra due computer in modo da non collegarli direttamente. Un proxy funziona, nella sua pratica, come un centralinista: riceve la chiamata da chi vuole telefonare e la gira all&#8217;interno desiderato.</p>
<p><strong><a href="https://mariadb.org/">MaxScale</a></strong> si può inserire in modo trasparente tra l&#8217;applicativo e il server MySQL, esattamente come fa un proxy web tra il nostro browser (es. Chrome) e il sito che stiamo cercando di visitare.</p>
<p><strong>Grazie ad un proxy è possibile avere</strong>:</p>
<ul>
<li><strong>Ridondanza</strong>: usando più di un database dietro al proxy. Un solo server non fornisce l&#8217;affidabilità e l&#8217;alta disponibilità in caso di down di una macchina.</li>
<li><strong>Diminuizione dei costi di infrastruttura</strong>: perché generalmente due server piccoli sono meno costosi che un unico server molto performante.</li>
</ul>
<p>Vedremo ora due tipologie di database proxy server:</p>
<p>I proxy di livello <strong>trasporto</strong> come HAProxy<br />
I proxy di livello <strong>applicativo</strong> come MaxScale</p>
<p><strong>HAProxy</strong>: un proxy efficiente, rapido e funzionale</p>
<p>Fino ad oggi il proxy più usato in ambito MySQL è l&#8217;<a href="http://www.haproxy.org/">HAProxy</a> che lavora ad un livello più basso (livello 4: trasporto). HAproxy non conosce nulla di MySQL e si occupa solo di bilanciare le connessioni tra più server. E&#8217; molto veloce, leggero ed efficente, tuttavia questo bilanciamento è fatto senza conoscere cosa sta smistando. Questo rende il sistema meno efficente poiché un server può ricevere molte richieste pesanti, mentre altri server possono essere scarichi. Quindi l&#8217;HAProxy non è la scelta vincente in tutti i casi.</p>
<p><strong>MaxScale</strong>: un proxy che può fare cose incredibili</p>
<p>MaxScale lavora a livello più alto (livello 7: applicativo), monitorando i server riesce a capire cosa sta succedendo all&#8217;interno dell&#8217;infrastruttura. Conoscendo il protocollo MySQL può intervenire manipolando il traffico tra client e server. Ecco alcune delle sue principali funzionalità:</p>
<ul>
<li>Filtro delle query al database</li>
<li>Gestione del routing: instradamento delle richieste a uno o più database server</li>
<li>Modifica delle query al volo prima che raggiungano il database</li>
<li>Possibilità di nascondere la struttura interna dell&#8217;infrastruttura lasciando un singolo punto d&#8217;accesso.</li>
<li>Alta affidabilità e scalabilità del sistema</li>
<li>Possibilità di spostare un database dal server locale ad un server esterno senza modificare la configurazione delle applicazioni</li>
<li>Divide automaticamente le scritture sul server MasterR e le letture su uno o più database Slave.</li>
</ul>
<p>MaxScale può fornire un Load Balacing delle connessioni senza bisogno di utilizzare applicazioni o CMS che prevedano questa funzionalità. Questo significa che CMS come WordPress o Joomla possono trarne dei benefici, usando una replicazione Master/Slave per rendere scalabile il proprio sito.</p>
<p><strong>Caratteristiche di MaxScale</strong></p>
<p>Il punto di forza di MaxScale è sicuramente la sua modularità che permette una notevole libertà adattandosi a molti casi d&#8217;uso, infatti MaxScale è:</p>
<ul>
<li>Modulare: un sistema di moduli ne definisce le funzionalità</li>
<li>Estendibile: è possibile applicare più filtri anche in cascata</li>
<li>Flessibile: i moduli e i filtri possono essere aggiunti dinamicamente</li>
</ul>
<p><strong>I moduli base di MaxScale</strong></p>
<p>Quelli elencati qui sotto sono i 5 moduli che costituiscono il cuore di MaxScale:</p>
<ul>
<li>Protocol: da la possibilità di utilizzare più protocolli es. MySQL client, http, telnet</li>
<li>Authentication: il sistema di autenticazione permette ai client di accedere a MaxScale usando le credenziali presenti sui server di Backend</li>
<li>Monitor: legge la configurazione dello stato del sistema direttamente dai server di backend</li>
<li>Router: smista le connessioni a uno o più database di backend</li>
<li>Filter e logging: i filtri permettono di modificare le query oppure di scrivere un file di log con tutte le richieste e le risposte ricevute.</li>
</ul>
<p>1. <strong>Protocollo di connessione<br />
</strong>I client si connettono a MaxScale anziché al database MySQL senza accorgersi della differenza. Possono usare le stesse librerie di connessione utilizzate fino ad ora: es. MySQL client o MariaDB client.</p>
<p>2. <strong>Autenticazione</strong><br />
MaxScale non ha un sistema di autenticazione o un database di utenti. Vengono utilizzati gli stessi utenti presenti sui database di backend, caricati all&#8217;avvio dell&#8217;applicazione.</p>
<p>3. <strong>Monitor</strong><br />
Viene utilizzato per capire in ogni momento lo stato di tutti i database di backend collegati a MaxScale. In questo modo è possibile sapere qual&#8217;è il server Master e quanti Slave stanno replicando correttamentei dati.</p>
<p>4. <strong>Router</strong><br />
Dirige il traffico dal client ai server utilizzando una regola specifica:</p>
<ul>
<li>Connection routing: normale router di connessione ad un database</li>
<li>Read/Write Split router: smista le richieste di scrittura sul Master e le richieste di lettura su uno degli Slave collegati</li>
</ul>
<p>5. <strong>Filtri e log delle query<br />
</strong>Tra i più potenti strumenti messi a disposizione di MaxScale ci sono sicuramente i filtri che permettono di effettuare operazioni avanzate sulle query senza modificare il comportamento dell&#8217;applicazione:</p>
<ul>
<li>Processando query SQL e risultati</li>
<li>Utilizzando una semplice regex</li>
<li>Analizzando, modificando o rifiutando le query</li>
<li>Mettendo più filtri in cascata</li>
</ul>
<p>Insomma, da questo primo articolo, si deduce che le potenzialita&#8217; sono tutte a favore di MaxScale</p>
</div>
<p>&nbsp;</p>
<p>#MaxscaledbproxyserverMysql</p>
<div class="element element-itemauthor last"></div>
]]></content:encoded>
					
					<wfw:commentRss>https://tuttiperlinux.blog/2015/06/12/maxscale-db-proxy-scalabile/feed/</wfw:commentRss>
			<slash:comments>1</slash:comments>
		
		
		
		<media:content url="https://2.gravatar.com/avatar/855ab7cb725a5b56c356471b79d1cef6?s=96&#38;d=&#38;r=G" medium="image">
			<media:title type="html">lordisil72lordisil72</media:title>
		</media:content>

		<media:content url="https://tuttiperlinux.files.wordpress.com/2015/06/maxscale_mariadb_sceme.jpg?w=150" medium="image">
			<media:title type="html">MaxScale DB Proxy Server</media:title>
		</media:content>
	</item>
		<item>
		<title>HAPROXY – ed il bilanciamento di carico e&#8217; servito</title>
		<link>https://tuttiperlinux.blog/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/</link>
					<comments>https://tuttiperlinux.blog/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/#comments</comments>
		
		<dc:creator><![CDATA[Tutti per Linux]]></dc:creator>
		<pubDate>Sun, 22 Feb 2015 14:11:29 +0000</pubDate>
				<category><![CDATA[Networking]]></category>
		<category><![CDATA[SysAdmin]]></category>
		<category><![CDATA[WebServer]]></category>
		<category><![CDATA[backend]]></category>
		<category><![CDATA[bilanciatore di carico]]></category>
		<category><![CDATA[cloud server]]></category>
		<category><![CDATA[frontend]]></category>
		<category><![CDATA[haproxy]]></category>
		<category><![CDATA[http]]></category>
		<category><![CDATA[httplog]]></category>
		<category><![CDATA[https]]></category>
		<category><![CDATA[iso/osi]]></category>
		<category><![CDATA[layer]]></category>
		<category><![CDATA[load balancer]]></category>
		<category><![CDATA[roundrobin]]></category>
		<category><![CDATA[tcp]]></category>
		<category><![CDATA[troubleshooting]]></category>
		<category><![CDATA[webserver bilanciati]]></category>
		<guid isPermaLink="false">http://tuttiperlinux.com/?p=1025</guid>

					<description><![CDATA[Bilanciamento, chi è costui? Quando pensiamo a come implementare un servizio web, solitamente lo immaginiamo erogato da potenti server che, all&#8217;occorenza, sono in grado di scalare in automatico in modo da garantirne la continuità. Ma con i nuovi servizi cloud ad alta frequentazione, la mole di accessi che deve essere trattata sara&#8217; talmente elevata da mettere &#8230; <a href="https://tuttiperlinux.blog/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/">Continua a leggere <span class="meta-nav">&#8594;</span></a>]]></description>
										<content:encoded><![CDATA[<div data-shortcode="caption" id="attachment_1026" style="width: 310px" class="wp-caption alignleft"><img loading="lazy" aria-describedby="caption-attachment-1026" data-attachment-id="1026" data-permalink="https://tuttiperlinux.blog/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/ha-proxy_load-balancing/#main" data-orig-file="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png" data-orig-size="1024,370" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="ha-proxy_load-balancing" data-image-description="&lt;p&gt;HAProxy Load Balancing&lt;/p&gt;
" data-image-caption="&lt;p&gt;HAProxy Load Balancing&lt;/p&gt;
" data-medium-file="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=300" data-large-file="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=600" class="size-medium wp-image-1026" src="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=300&#038;h=108" alt="HAProxy Load Balancing" width="300" height="108" srcset="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=300&amp;h=108 300w, https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=598&amp;h=216 598w, https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=150&amp;h=54 150w" sizes="(max-width: 300px) 100vw, 300px" /><p id="caption-attachment-1026" class="wp-caption-text">HAProxy Load Balancing</p></div>
<p><strong>Bilanciamento, chi è costui?</strong><br />
Quando pensiamo a come implementare un servizio web, solitamente lo immaginiamo erogato da potenti server che, all&#8217;occorenza, sono in grado di scalare in automatico in modo da garantirne la continuità.<br />
Ma con i nuovi servizi cloud ad alta frequentazione, la mole di accessi che deve essere trattata sara&#8217; talmente elevata da mettere in crisi qualunque configurazione.</p>
<p>Come evitare una situazione del genere? Utilizzare ulteriore hardware, più potente, potrebbe non essere sufficiente, inoltre gestire una configurazione composta da sempre più server richiede l’introduzione di un “oggetto” capace di distribuire le connessioni su tutte le macchine installate.</p>
<p>L’oggetto a cui facciamo riferimento è un <strong>Load Balancer</strong> (bilanciatore di carico), capace di distribuire tutte le connessioni entranti tra i vari server assegnati alla funzionalita&#8217; del nostro servizio.<br />
Così facendo sara&#8217; possibile:</p>
<ul>
<li><i></i>migliorare l’alta affidabilità del servizio, perchè le richieste verranno sempre e solo, indirizzate ai server “attivi”;</li>
<li><i></i>migliorare la disponibilità del servizio, perchè le richieste verranno inviate ai server meno “carichi” in quel momento.</li>
</ul>
<p><strong>La soluzione: HAPROXY</strong><br />
Esistono molte soluzioni commerciali in tema di Load Balancing, ma può essere più interessante, sfruttabile, performante e conveniente, ricorrere a prodotti Open Source e, tra questi, c’è <strong>HAPROXY</strong>.<br />
HAPROXY (<a href="http://haproxy.1wt.eu/">http://www.haproxy.org/</a>) è un bilanciatore in grado di gestire sia connessioni HTTP/HTTPS che connessioni di tipo TCP.</p>
<p><strong>Utilizzo</strong><br />
Per prendere coscienza di quali siano le potenzialità di HAPROXY, proviamo a fare due esempi d&#8217;impiego delle funzionalità di bilanciamento, una dedicata ad un servizio di puro HTTP, e l’altra dedicata a bilanciare un servizio esclusivamente TCP.<br />
Per provare le funzionalità di HAPROXY ho realizzato un ambiente virtuale con <a title="Virtualizzazione e provisioning senza sforzo" href="http://tuttiperlinux.com/2015/01/03/virtualizzazione-e-provisioning-senza-sforzo/">vagrant</a> costituito da tre macchine virtuali:</p>
<ul>
<li>1 macchina Gentoo (molto leggera e performante) utilizzata come bilanciatore (loadbalancer)</li>
<li>2 macchine Ubuntu utilizzate come server da bilanciare (web1 e web2)</li>
</ul>
<p>Installiamo HAPROXY  sulla macchina Gentoo, attraverso il comando:</p>
<pre>emerge haproxy</pre>
<p>Mentre sulle macchine Ubuntu procediamo con l’installazione di Apache utilizzando il comando:<br />
<code></code></p>
<pre>apt-get install apache2</pre>
<p>Tutte le macchine sono state collegate alla stessa rete: 192.168.0.0/24:</p>
<ul>
<li><i></i><strong>loadbalancer</strong>: configurato con l’indirizzo fisico 192.168.0.<strong>254</strong>, e con due alias, per i servizi bilanciati, 192.168.0.<strong>253</strong> e 192.168.0.<strong>252</strong>.</li>
</ul>
<ul>
<li><i></i><strong>web1</strong>: indirizzo 192.168.0.31.</li>
</ul>
<ul>
<li><i></i><strong>web2</strong>: indirizzo 192.168.0.32.</li>
</ul>
<p>Si ricorre all’uso degli <strong>alias</strong> <strong>di rete</strong> per poter pubblicare i due servizi di bilanciamento su indirizzi distinti; in alternativa sarebbe stato possibile pubblicare tutti i servizi di bilanciamento sullo stesso indirizzo fisico del server loadbalancer, perché, nel nostro caso, le porte di ascolto dei due servizi sono comunque differenti; ovviamente, se si vogliono bilanciare più servizi che ascoltano sulla stessa porta l’impiego degli alias è inevitabile.</p>
<p>La configurazione di un servizio di bilanciamento in HAPROXY, può essere realizzata definendo una sezione di “<strong>frontend</strong>” ed una di “<strong>backend</strong>”; la prima serve per definire il punto di accesso dei client (internet), mentre la seconda viene utilizzata per definire l’insieme dei server a cui inviare le connessioni da bilanciare.<br />
In alternativa, è possibile configurare un’unica sezione, “<strong>listen</strong>”, in cui vengono racchiuse sia le direttive che verrebbero utilizzate per configurare le sezioni di “frontend” e di “backend”.</p>
<p><strong>Esempi di impiego di HAPROXY</strong><br />
Il file di configurazione del servizio si trova in <strong>/etc/haproxy/haproxy.cfg</strong>.</p>
<p>La configurazione di Haproxy è stata impostata per includere una sezione in cui inserire i parametri che agiscono a livello globale (“global”), nel nostro caso viene configurato il log degli eventi.<br />
Viene poi configurata una sezione in cui riportare tutte quelle impostazioni che costituiranno la base di ciascun servizio bilanciato (sezione “defaults”).</p>
<pre>global
log /dev/log local0
log /dev/log local1 notice

</pre>
<pre>defaults
timeout client 5000
timeout connect 5000
timeout server 5000
</pre>
<p>Nella sezione “defaults” sono quindi impostati i valori dei timeout:</p>
<ul>
<li><i></i>i timeout di <strong>inattività lato client</strong> mentre si attende una risposta dal server (timeout client);</li>
</ul>
<ul>
<li><i></i>i timeout di <strong>attesa di attivazione</strong> di una <strong>connessione</strong> al server (timeout connect);</li>
</ul>
<ul>
<li><i></i>il timeout di <strong>inattività lato server</strong> (timeout server).</li>
</ul>
<p>Tutti i valori di timeout sono stati impostati a 5000 millisecondi (5 secondi); ma possono essere adeguati in base alle proprie necessità.</p>
<p><strong>Esempio 1: bilanciare il web</strong><br />
In questo primo esempio, HAPROXY viene utilizzato per bilanciare le richieste indirizzate a due server web, configurati per pubblicare una semplice pagina HTML (index2.html) che visualizza una serie di immagini (differenti tra i due server web, così da rendere evidente all’utente su quale server si è stati bilanciati).</p>
<pre>frontend webfront
bind 192.168.0.253:80
default_backend webback</pre>
<pre>backend webback
balance roundrobin
server web1 192.168.0.31:80 check inter 5000 rise 2 fall 3 weight 10
server web2 192.168.0.32:80 check inter 5000 rise 2 fall 3 weight 10
mode http
log global
option httplog
option httpchk GET /index.html
</pre>
<p>All’interno della sezione “frontend” viene specificato l’indirizzo su cui si pone in ascolto il bilanciatore per il servizio specifico, e viene poi incluso il riferimento alla configurazione di “backend”, contenente informazioni sui server da bilanciare.</p>
<p>Nella parte “backend”, si può specificare quale metodologia di bilanciamento da utilizzare, quindi con quale criterio distribuire le richieste dei client, in questo caso il bilanciamento è di tipo “<strong>round robin</strong>”, cioè le richieste vengono inviate alternativamente ai due server bilanciati 50 &amp; 50 % .<br />
Con la direttiva “server” vengono specificati tutti i server che si vogliono bilanciare, identificando ciascuno con un nome (non necessariamente corrispondente all’hostname del server), l’indirizzo IP e la porta su cui ascolta il servizio (in questo esempio, la porta TCP/80 per il web server).<br />
Per ogni server, vengono poi specificati i criteri da seguire per controllare se questo è attivo (a livello di servizio web) o meno, in modo da poterlo escludere a fronte di un problema.<br />
Con l’opzione “<strong>check</strong>” viene specificata la frequenza con cui controllare il server (“inter”, impostata a 5000 millisecondi), dopo quanti check falliti il server deve essere escluso dal bilanciamento (“<strong>fall</strong>”), oppure dopo quanti check andati a buon fine (“<strong>rise</strong>”), invece, deve essere reinserito nel bilanciamento, ed il peso (“<strong>weight</strong>”) di ciascun server, in modo da poter distribuire il carico in maniera proporzionale tra le varie macchine, cosi da poter meglio bilanciare lo sforzo dei server nel caso che questi avessero hadrware con prestazioni differenti, infatti impostando un server con un peso maggiore rispetto alle altre macchine, questo riceverà un numero di richieste maggiore.</p>
<p>Se non si specificheranno particolari direttive, Haproxy verificera&#8217; solo la disponibilità del servizio su ciascun server, controllando se la porta TCP specificata è in ascolto o meno.<br />
Nel caso di web server bilanciati, è possibile definire dei controlli specifici sul protocollo HTTP interrogando direttamente la parte web, cosi che, a fronte di una risposta HTTP diversa dal codice 200 (OK) , il server verra&#8217; escluso (“option httpchk”).</p>
<p>Con l’opzione <strong>httplog</strong> si attiva anche un livello di log per tutte le richieste HTTP che arrivano al bilanciatore per quel determinato servizio.<br />
Particolare attenzione va riservata alle impostazioni di “rise” e “fall”, per cercare il giusto equilibrio che consenta di evitare che un server venga escluso, o reinserito troppo velocemente dal bilanciamento.</p>
<p><strong>Esempio 2: bilanciare un servizio TCP</strong><br />
Oltre a bilanciare servizi HTTP, Haproxy può bilanciare praticamente qualsiasi tipo di connessione TCP; nel nostro test, sui due server attivati e&#8217; stato configurato in ascolto, un servizio sulla porta TCP/2222.<br />
In queso caso, HAPROXY è configurato per restare in ascolto su un indirizzo IP diverso da quello del servizio web dell’esempio precedente, e diverso dall’indirizzo fisico del bilanciatore.</p>
<pre>frontend sshfront
bind 192.168.0.252:2222
default_backend sshbe</pre>
<pre>backend sshback
balance roundrobin
server ssh1 192.168.0.31:2222 check inter 5000 rise 2 fall 3 weight 10
server ssh2 192.168.0.32:2222 check inter 5000 rise 2 fall 3 weight 10
</pre>
<p><strong>Troubleshooting</strong><br />
All’interno dei log generati da haproxy è possibile rilevare gli eventi in cui un server viene escluso, oppure incluso, nel bilanciamento.<br />
Nel caso in cui il server (o il servizio) bilanciato non sia disponibile verrà registrato il seguente evento:</p>
<p><code>Feb 22 10:30:50 localhost haproxy[23679]: Server webbe/web2 is DOWN, reason: Layer4 connection problem, info: "Connection refused", check duration: 0ms. 1 active and 0 backup servers left. 0 sessions active, 0 requeued, 0 remaining in queue.<br />
</code></p>
<p>Nel momento in cui il server/servizio torna disponibile nei log di Haproxy si troverà, invece, questo evento:</p>
<p><code>Feb 22 10:32:10 localhost haproxy[23679]: Server webbe/web2 is UP, reason: Layer7 check passed, code: 200, info: "OK", check duration: 0ms. 2 active and 0 backup servers online. 0 sessions requeued, 0 total in queue.<br />
</code></p>
<p><strong>Conclusioni</strong><br />
Haproxy offre la possibilità di risolvere problemi di eccessivo carico, ma anche di realizzare un meccanismo di alta affidabilità per diverse architetture di server, con questo approccio si semplifichera&#8217; quindi la gestione dei sistemi e dei servizi.<br />
Le funzionalità di Haproxy non si fermano solo agli esempi trattati precedentemente, ma permettono di creare servizi di bilanciamento capaci di lavorare <strong>dal livello 3 al livello 7</strong> della pila <strong>ISO/OSI</strong>.<br />
Vedremo in un secondo tempo di approfondire le varie funzionalità avanzate che Haproxy mette a disposizione.</p>
<p>&nbsp;</p>
<p>#Haproxy#Bilanciatoredicarico</p>
]]></content:encoded>
					
					<wfw:commentRss>https://tuttiperlinux.blog/2015/02/22/haproxy-ed-il-bilanciamento-di-carico-e-servito/feed/</wfw:commentRss>
			<slash:comments>1</slash:comments>
		
		
		
		<media:content url="https://2.gravatar.com/avatar/855ab7cb725a5b56c356471b79d1cef6?s=96&#38;d=&#38;r=G" medium="image">
			<media:title type="html">lordisil72lordisil72</media:title>
		</media:content>

		<media:content url="https://tuttiperlinux.files.wordpress.com/2015/02/ha-proxy_load-balancing.png?w=300" medium="image">
			<media:title type="html">HAProxy Load Balancing</media:title>
		</media:content>
	</item>
	</channel>
</rss>

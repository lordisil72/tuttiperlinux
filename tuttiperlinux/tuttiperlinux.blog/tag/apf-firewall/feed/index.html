<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	xmlns:georss="http://www.georss.org/georss" xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#" xmlns:media="http://search.yahoo.com/mrss/"
	>

<channel>
	<title>apf firewall &#8211; Tutti per Linux</title>
	<atom:link href="https://tuttiperlinux.blog/tag/apf-firewall/feed/" rel="self" type="application/rss+xml" />
	<link>https://tuttiperlinux.blog</link>
	<description>Tutto cio&#039; che avresti sempre voluto capire su Linux ed il mondo Digitale</description>
	<lastBuildDate>Sat, 28 Feb 2015 21:04:18 +0000</lastBuildDate>
	<language>it-IT</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>http://wordpress.com/</generator>
<cloud domain='tuttiperlinux.blog' port='80' path='/?rsscloud=notify' registerProcedure='' protocol='http-post' />
<image>
		<url>https://secure.gravatar.com/blavatar/fa5c4cf69896031d9ec71ff8d5aafd25?s=96&#038;d=https%3A%2F%2Fs0.wp.com%2Fi%2Fbuttonw-com.png</url>
		<title>apf firewall &#8211; Tutti per Linux</title>
		<link>https://tuttiperlinux.blog</link>
	</image>
	<atom:link rel="search" type="application/opensearchdescription+xml" href="https://tuttiperlinux.blog/osd.xml" title="Tutti per Linux" />
	<atom:link rel='hub' href='https://tuttiperlinux.blog/?pushpress=hub'/>
	<item>
		<title>Proteggiti da attacchi DoS e DDoS</title>
		<link>https://tuttiperlinux.blog/2015/02/28/proteggiti-da-attacchi-dos-e-ddos/</link>
					<comments>https://tuttiperlinux.blog/2015/02/28/proteggiti-da-attacchi-dos-e-ddos/#respond</comments>
		
		<dc:creator><![CDATA[Tutti per Linux]]></dc:creator>
		<pubDate>Sat, 28 Feb 2015 21:04:18 +0000</pubDate>
				<category><![CDATA[Sicurezza]]></category>
		<category><![CDATA[SysAdmin]]></category>
		<category><![CDATA[apf firewall]]></category>
		<category><![CDATA[attacchi DDoS]]></category>
		<category><![CDATA[attacchi DoS]]></category>
		<category><![CDATA[banda utilizzata]]></category>
		<category><![CDATA[iptables]]></category>
		<category><![CDATA[monitoring]]></category>
		<category><![CDATA[munin]]></category>
		<category><![CDATA[netstat]]></category>
		<category><![CDATA[nullroute]]></category>
		<category><![CDATA[syn_flood]]></category>
		<category><![CDATA[sysctl_syncookies]]></category>
		<category><![CDATA[tcptrack]]></category>
		<category><![CDATA[tcp_ports]]></category>
		<category><![CDATA[vnstat]]></category>
		<guid isPermaLink="false">http://tuttiperlinux.com/?p=1037</guid>

					<description><![CDATA[Proteggere il server dagli attacchi DoS e DDoS  Un attacco DoS (Denial of Service), ha come scopo il rendere inutilizzabile un determinato servizio sul web, inondandolo di richieste fittizie, quindi qualsiasi servizio esposto su internet che fornisce servizi di rete basati sul protocollo TCP/IP e soggetto al potenziale rischio di attacchi DoS. La differenza tra &#8230; <a href="https://tuttiperlinux.blog/2015/02/28/proteggiti-da-attacchi-dos-e-ddos/">Continua a leggere <span class="meta-nav">&#8594;</span></a>]]></description>
										<content:encoded><![CDATA[<div data-shortcode="caption" id="attachment_1038" style="width: 302px" class="wp-caption alignleft"><img loading="lazy" aria-describedby="caption-attachment-1038" data-attachment-id="1038" data-permalink="https://tuttiperlinux.blog/2015/02/28/proteggiti-da-attacchi-dos-e-ddos/server-protection/#main" data-orig-file="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg" data-orig-size="316,325" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Server-protection" data-image-description="&lt;p&gt;APF-Firewall Server Protection&lt;/p&gt;
" data-image-caption="&lt;p&gt;APF-Firewall Server Protection&lt;/p&gt;
" data-medium-file="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=292" data-large-file="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=316" class="size-medium wp-image-1038" src="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=292&#038;h=300" alt="APF-Firewall Server Protection" width="292" height="300" srcset="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=292&amp;h=300 292w, https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=146&amp;h=150 146w, https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg 316w" sizes="(max-width: 292px) 100vw, 292px" /><p id="caption-attachment-1038" class="wp-caption-text">APF-Firewall Server Protection</p></div>
<p><strong>Proteggere il server dagli attacchi DoS e DDoS </strong></p>
<p>Un attacco DoS (Denial of Service), ha come scopo il rendere inutilizzabile un determinato servizio sul web, inondandolo di richieste fittizie, quindi qualsiasi servizio esposto su internet che fornisce servizi di rete basati sul protocollo TCP/IP e soggetto al potenziale rischio di attacchi DoS. La differenza tra DoS e DDoS (Distributed Denial of Service) sta nel numero di macchine (PC, server, cellulari, in generale, qualsiasi dispositivo connesso ad internet che sia stato compromesso) utilizzate per lanciare l&#8217;attacco. Nel caso di un DoS l&#8217;attacco avviene da una sola macchina, mentre (nel ben piu difficile caso da bloccare) nel DDoS l&#8217;attacco puo avvenire contemporaneamente da centinaia di macchine diverse.</p>
<p>Come potrete quindi immaginare tutti i consigli contenuti in questo articolo non vi assicureranno una protezione totale contro i DDoS, perché quando sono ben organizzati e l’attacco arriva da un grande numero di macchine diverse, l’unico modo per cercare di bloccarlo o più realisticamente, mitigarlo, è agire a monte, direttamente sull’infrastruttura del vostro provider (che quindi dovrete contattare), a meno che non abbiate una vostra infrastruttura di rete.</p>
<p><strong>Come riconoscere un attacco </strong>?</p>
<p>Questa è sicuramente la prima cosa da imparare, ossia imparare a riconoscere un attacco DoS, perche&#8217; tante volte si corre il rischio di pensare ad un attacco di questo tipo appena i servizi ospitati sul server risultano irraggiungibili, quando invece le cose più probabili sono ben altre.<br />
Innanzitutto se siete sotto attacco vedrete sicuramente un picco (che può variare da pochi a diversi mbit/s) nei vostri grafici della banda utilizzata, ed un picco nelle connessioni netstat, anche per questo sarebbe bene generare dei grafici di tutto rispetto magari tramite Munin (di cui parleremo nel prossimo articolo) o con <a title="Grafici di rete con Vnstat" href="http://tuttiperlinux.com/2014/08/01/238/">Vnstat</a>, i servizi più importanti sul vostro server.</p>
<p>Una volta accertato che ci sono effettivamente picchi anomali nell’utilizzo della banda, usate questo comando per visualizzare lo stato di tutte le connessioni attive sul vostro server:</p>
<pre>netstat -nat | awk ‘{print $6}’ | sort | uniq -c | sort –n</pre>
<p>L’output sarà qualcosa del genere:</p>
<pre>1 CLOSING

1 established

1 Foreign

7 LAST_ACK

25 FIN_WAIT1

26 LISTEN

69 FIN_WAIT2

484 TIME_WAIT

542 ESTABLISHED</pre>
<p>Se notate che ci sono diverse connessioni in stato <strong>SYS_SENT</strong> siete sicuramente sotto attacco, a questo punto non resta altro da fare che individuare l’IP o gli IP dai quali arrivano più connessioni, potete farlo con questo comando:</p>
<pre>netstat -atun | awk ‘{print $5}’ | cut -d: -f1 | sed -e ‘/^$/d’ |sort | uniq -c | sort –n</pre>
<p>A questo punto avrete una lista ordinata per numero di connessioni aperte da ogni IP, ed alla fine, molto probabilmente, avrete gli IP delle macchine dalle quali vi stanno attaccando, ora non resta che bloccare questi IP.<br />
Una utility molto utile per analizzare il traffico di rete e vederlo in tempo reale è <strong>tcptrack</strong>, una volta installata usate i seguenti comandi per avviare il monitoring:</p>
<p><strong>tcptrack -i eth0</strong> vi mostrerà tutto il traffico attivo sulla scheda di rete</p>
<p><strong>tcptrack -i eth0</strong> <strong>port 80</strong> vi mostrerà tutto il traffico sulla porta 80</p>
<p>Es:</p>
<pre>tcptrack -i eth0 src or dst 192.168.2.138</pre>
<p>vi mostrerà tutto il traffico generato dall’ip specificato. In più tcptrack vi mosterà in tempo reale l’utilizzo della banda.</p>
<p><strong>Bloccare un attacco</strong></p>
<p>Ora che sappiamo individuare un attacco e capire da quali IP sta arrivando possiamo cercare di bloccarlo, vediamo come.<br />
Premesso che la cosa migliore sarebbe comunicare gli IP degli attaccanti al vostro provider così che possano essere bloccati a monte e che non possano quindi influire neanche minimamente sulla vostra banda disponibile, esistono principalmente due metodi per bloccare questi IP sul vostro server: bloccarli con<strong> iptables</strong>, oppure metterli in <strong>nullroute</strong> (che è, secondo me, preferibile).</p>
<p>Per bloccare questi IP da itptables potete usare questo semplice comando:</p>
<p><strong>iptables -A INPUT -s IP-ATTACCANTE -j DROP</strong></p>
<p>Invece, per mettere un IP in nullroute, dobbiamo lanciare questo comando:</p>
<p><strong>route add IP-ATTACANTE gw 127.0.0.1 lo</strong></p>
<p>Possiamo anche mettere in nullroute un&#8217; intera subnet ad esempio così:</p>
<p><strong>route add -net 192.168.2.0/24 gw 127.0.0.1 lo</strong></p>
<p>Verifichiamo quindi che i settaggi siano stati effettivamente applicati con</p>
<p><strong>netstat -nr<br />
</strong></p>
<p>Per rimuovere il nullroute possiamo utilizzare il comando <strong>route delete IP</strong></p>
<p>Per far sì che i nullroute impostati vengano mantenuti al reboot dovrete scrivere gli stessi comandi di prima nel file /etc/rc.local</p>
<p><strong><br />
Come prevenire gli attacchi</strong></p>
<p>Fin’ora abbiamo visto come comportarci una volta sotto attacco, ora vediamo cosa possiamo fare per evitare di trovarci coi servizi down e doverli ripristinare.<br />
Per prima cosa consiglio di installare <strong>APF</strong> (Advanced Policy Firewall), un firewall basato su iptables che bloccherà autonomamente molti degli attacchi conosciuti, confrontandone i pattern, in più, grazie alla sua semplice e versatile configurazione diventa un&#8217;ottimo sostituto di iptables che spesso risulta abbastanza macchinoso da mantenere.</p>
<p>Potete installare APF usando un packet manager tipo apt o yum, oppure compilando l’ultima versione :</p>
<p>Scaricate l’ultima versione stabile:</p>
<p><strong>wget <a href="http://www.rfxnetworks.com/downloads/apf-current.tar.gz" rel="nofollow">http://www.rfxnetworks.com/downloads/apf-current.tar.gz</a></strong></p>
<p>Scompattate il file appena scaricato: <strong>tar -xvzf apf-current.tar.gz</strong></p>
<p>Entrate nella directory creata ed eseguite <strong>./install.sh</strong></p>
<p>A questo punto APF va configurato a dovere e, per farlo, bastera&#8217; editare il file <strong>/etc/apf/conf.apf</strong> .</p>
<p>Per prima cosa bisognera&#8217; settare il parametro <strong>DEVEL_MODE</strong> a 1, così se sbagliate qualche settaggio e vi chiudete fuori dal server, dopo 5 minuti il firewall verrà automaticamente stoppato.</p>
<p>Questo parametro indica se apf è in modalità sviluppo (e quindi non applica le regole) o in modalità produzione e quindi rende effettive le regole del firewall, prima di impostarlo a 0 per renderlo attivo modifichiamo il resto delle regole altrimenti rischiamo di chiuderci fuori dal server</p>
<p>Impostiamo le porte in ascolto modificando il paramentro IG_TCP_CPORTS</p>
<pre># Common inbound (ingress) TCP ports
IG_TCP_CPORTS="22,21,20,80,25,53,110,143,443,2222,587,953,993,995,4949"</pre>
<p>io utilizzo queste impostazioni che sono per i servizi ssh,ftp,web,mail (pop/imap/smtp), directadmin e munin</p>
<div>e queste sono le impostazioni per le porte in uscita</div>
<pre># Common outbound (egress) TCP ports
EG_TCP_CPORTS="21,25,80,443,43"</pre>
<p>e poi più sotto impostiamo a “1″ le seguenti variabili che ci permettono di scaricare delle liste di ip conosciuti come malevoli in modo da filtrare a priori il loro traffico</p>
<pre>DLIST_PHP="1"
DLIST_SPAMHAUS="1"
DLIST_DSHIELD="1"
DLIST_RESERVED="1"</pre>
<p><strong>Ricordatevi</strong> di rimettere su <strong>0</strong> questo parametro una volta terminata la configurazione, altrimenti il firewall funzionerà solo per 5 minuti ad ogni riavvio.</p>
<p>Settate su <strong>1</strong> tutti i parametri che abilitano le liste di network malefici dai quali le connessioni saranno rifiutate (DLIST_*).</p>
<p>Settate manualmente le porte TCP che devono rimanere aperte nella variabile IG_TCP_CPORTS (ad esempio la 80 per il traffico web, se avete modificato la porta di ssh come avreste dovuto fare ricordatevi di settarla qua, altrimenti vi chiuderete fuori dal server), tutte le altre risulteranno chiuse.</p>
<p>Stessa cosa per le porte UDP subito sotto, se ne fate uso.</p>
<p>Impostando il parametro <strong>SYSCTL_SYNCOOKIES</strong> su 1, vi proteggerà dagli attacchi di tipo <strong>syn flood</strong>.</p>
<p>salviamo ed avviamo apf con</p>
<pre>apf -s</pre>
<p>#Proteggiti#AttacchiDoSeDDoS</p>
]]></content:encoded>
					
					<wfw:commentRss>https://tuttiperlinux.blog/2015/02/28/proteggiti-da-attacchi-dos-e-ddos/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
		
		<media:content url="https://2.gravatar.com/avatar/855ab7cb725a5b56c356471b79d1cef6?s=96&#38;d=&#38;r=G" medium="image">
			<media:title type="html">lordisil72lordisil72</media:title>
		</media:content>

		<media:content url="https://tuttiperlinux.files.wordpress.com/2015/02/server-protection.jpg?w=292" medium="image">
			<media:title type="html">APF-Firewall Server Protection</media:title>
		</media:content>
	</item>
	</channel>
</rss>
